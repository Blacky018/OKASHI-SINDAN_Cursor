# コード解説ドキュメント

このドキュメントでは、お菓子診断アプリの各コードファイルについて詳しく解説します。

## 目次

1. [トップページ (src/app/page.tsx)](#トップページ)
2. [診断ページ (src/app/diagnose/page.tsx)](#診断ページ)
3. [結果ページ (src/app/result/page.tsx)](#結果ページ)
4. [診断ロジック (src/lib/diagnosis.ts)](#診断ロジック)
5. [ルートレイアウト (src/app/layout.tsx)](#ルートレイアウト)
6. [データファイル](#データファイル)

---

## トップページ

**ファイル**: `src/app/page.tsx`

### 概要
アプリの最初の画面で、ユーザーにアプリの説明と診断開始ボタンを表示します。

### 主なポイント

- **'use client'**: クライアントコンポーネントとして動作（ブラウザで実行）
- **Linkコンポーネント**: Next.jsの最適化されたリンク（ページ遷移が高速）
- **Tailwind CSS**: ユーティリティファーストのCSSフレームワークでスタイリング

### 主要なクラス

- `flex min-h-screen`: 画面全体をFlexboxで中央配置
- `bg-gradient-to-br`: グラデーション背景（左上から右下）
- `hover:scale-105`: ホバー時にボタンが1.05倍に拡大

---

## 診断ページ

**ファイル**: `src/app/diagnose/page.tsx`

### 概要
ユーザーに質問を順番に表示し、回答を収集して診断を実行します。

### 主な機能

1. **状態管理**
   - `currentQuestionIndex`: 現在の質問番号を管理
   - `answers`: ユーザーの回答を配列で保存

2. **進捗表示**
   - 進捗バーで質問の進捗を視覚化
   - 「1 / 5」のような形式で現在の質問番号を表示

3. **回答処理**
   - `handleAnswer`関数で回答を処理
   - 全ての質問に答えると診断を実行し、結果ページに遷移

### フロー

```
質問表示 → 回答選択 → 次の質問 or 診断実行 → 結果ページへ遷移
```

---

## 結果ページ

**ファイル**: `src/app/result/page.tsx`

### 概要
診断結果として選ばれたお菓子の情報を表示します。

### 主なポイント

1. **Suspenseの使用**
   - `useSearchParams`を使うため、`Suspense`でラップする必要がある
   - Next.js 14のApp Routerの要件

2. **URLパラメータの取得**
   - `?id=1`のようなクエリパラメータからお菓子のIDを取得
   - IDからお菓子データを検索して表示

3. **エラーハンドリング**
   - お菓子が見つからない場合のエラー表示

### 表示内容

- お菓子の名前とカテゴリ
- 説明文
- おすすめポイント
- 価格帯と甘さ
- 再診断・トップに戻るボタン

---

## 診断ロジック

**ファイル**: `src/lib/diagnosis.ts`

### 概要
ユーザーの回答に基づいて最適なお菓子を選出するアルゴリズムです。

### スコアリングシステム

各お菓子に対して、回答との一致度に応じてスコアを計算します：

| 質問 | マッチング条件 | スコア |
|------|---------------|--------|
| 質問1（気分） | お菓子のmood配列に含まれる | +3点 |
| 質問2（時間帯） | お菓子のtime配列に含まれる | +2点 |
| 質問4（食感） | お菓子のtexture配列に含まれる | +2点 |
| 質問5（甘さ） | お菓子のsweetnessと完全一致 | +2点 |

### アルゴリズムの流れ

1. 全てのお菓子に対してスコアを計算
2. スコアが高い順にソート
3. 最もスコアの高いお菓子を返す
4. 全てのスコアが0の場合はランダムに選ぶ

### カスタマイズのポイント

- スコアの重みを変更することで、診断の精度を調整可能
- 新しい質問を追加する場合は、この関数にマッチングロジックを追加

---

## ルートレイアウト

**ファイル**: `src/app/layout.tsx`

### 概要
全ページに適用される共通レイアウトです。

### 主な機能

1. **メタデータ設定**
   - ページタイトルと説明文を設定（SEO対策）

2. **フォント設定**
   - Google FontsからInterフォントを読み込み
   - Next.jsが自動的に最適化

3. **グローバルスタイル**
   - `globals.css`をインポートしてTailwind CSSを有効化

### 重要なポイント

- このファイルは全ページの親要素になる
- `{children}`に各ページのコンテンツが入る

---

## データファイル

### お菓子データ (src/data/sweets.json)

各お菓子の情報をJSON形式で管理しています。

**データ構造**:
```json
{
  "id": 1,
  "name": "チョコレート",
  "category": "チョコレート",
  "description": "濃厚で滑らかな味わい...",
  "price_range": "100-200円",
  "texture": ["しっとり"],
  "sweetness": "甘め",
  "mood": ["リラックス", "甘いものが欲しい"],
  "time": ["昼", "夜"],
  "image": "/images/chocolate.jpg",
  "recommendation": "疲れた時やリラックスしたい時に..."
}
```

### 質問データ (src/data/questions.json)

診断で使用する質問と選択肢を定義しています。

**データ構造**:
```json
{
  "id": 1,
  "question": "今の気分は？",
  "options": [
    { "value": "リラックス", "label": "リラックスしたい" },
    { "value": "元気になりたい", "label": "元気になりたい" }
  ]
}
```

---

## 技術スタック

- **Next.js 14**: Reactフレームワーク（App Router使用）
- **TypeScript**: 型安全性を提供
- **Tailwind CSS**: ユーティリティファーストのCSS
- **React Hooks**: useState, useRouter, useSearchParams

---

## カスタマイズ方法

### お菓子を追加する

`src/data/sweets.json`に新しいお菓子オブジェクトを追加

### 質問を追加する

1. `src/data/questions.json`に質問を追加
2. `src/lib/diagnosis.ts`の`diagnose`関数にマッチングロジックを追加

### デザインを変更する

各コンポーネントの`className`属性のTailwind CSSクラスを変更

### 診断ロジックを改善する

`src/lib/diagnosis.ts`のスコアリングシステムを調整

---

## よくある質問

**Q: なぜSuspenseを使うの？**
A: Next.js 14のApp Routerでは、`useSearchParams`を使うコンポーネントは`Suspense`でラップする必要があります。

**Q: 'use client'は何？**
A: Next.js 13以降では、デフォルトでサーバーコンポーネントですが、`useState`などのフックを使う場合は`'use client'`を指定する必要があります。

**Q: 診断ロジックを変更したい**
A: `src/lib/diagnosis.ts`の`diagnose`関数を編集してください。スコアの重みやマッチング条件を変更できます。

